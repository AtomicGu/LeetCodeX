"""这次尝试让我彻底搞懂了档次算法

档次算法的剪枝：
    如果能够确定每件事开销的上下界，就可以据此进行剪枝
    最常见的是开销的下界是正数，这样，就可以根据资金裁剪掉档次表的下半部分
"""

from bisect import bisect_right  # 注意这里要用right！
from fractions import Fraction
from math import ceil
from typing import List


class Solution:
    def minSkips(self, dist: List[int], speed: int, hoursBefore: int) -> int:
        costs = [Fraction(i, speed) for i in dist]

        # ! 递归化循环
        prices = [costs[0]]
        grades = [0]

        for cost in costs[1:]:
            ite = iter(zip(prices, grades))

            # 首个特殊处理
            price, grade = next(ite)
            if price.denominator == 1:
                new_prices = [price + cost]
                new_grades = [grade]
            else:
                new_prices = [price + cost, ceil(price) + cost]
                new_grades = [grade + 1, grade]

            # 剩下的一般处理
            for i, (price, grade) in enumerate(ite, 1):
                a = price + cost

                # ! 价格过低，剪枝（危险）
                cost_upper_bound = 3
                if a < hoursBefore - cost_upper_bound * (len(costs) - i):
                    continue

                # 价格过高，剪枝
                if a > hoursBefore:
                    break

                if price.denominator == 1:
                    new_prices.append(price + cost)
                    new_grades.append(grade)
                else:
                    if a < new_prices[-1]:
                        new_prices[-1] = a  # grade+1
                    new_prices.append(ceil(price) + cost)
                    new_grades.append(grade)

            prices = new_prices
            grades = new_grades

        my = bisect_right(prices, hoursBefore) - 1
        if my == -1:
            return -1
        return grades[my]


sln = Solution()
ans = sln.minSkips(
    [
        96803,
        19602,
        61996,
        1277,
        23149,
        55250,
        65484,
        17626,
        82661,
        67766,
        69991,
        94446,
        41384,
        63783,
        39327,
        32896,
        73681,
        74428,
        6254,
        52220,
        12973,
        90511,
        21410,
        7870,
        28242,
        33331,
        62461,
        82558,
        12623,
        58964,
        97596,
        43865,
        34049,
        47313,
        47227,
        73447,
        73072,
        33780,
        45108,
        2600,
        53971,
        15891,
        46019,
        89075,
        79375,
        26078,
        75610,
        75484,
        85180,
        85083,
        70575,
        22878,
        37305,
        46545,
        42611,
        88237,
        66905,
        63897,
        96538,
        58581,
        10278,
        49948,
        80435,
        37556,
        60785,
        82800,
        18986,
        21965,
        83963,
        44223,
        55289,
        82743,
        80257,
        74926,
        53055,
        9352,
        10370,
        21234,
        45040,
        29913,
        41089,
        41534,
        85592,
        38189,
        93118,
        35059,
        79350,
        84495,
        51834,
        35554,
        58314,
        47601,
        98029,
        76929,
        68281,
        59021,
        54263,
        21931,
        24103,
        3028,
        16390,
        95391,
        30754,
        86773,
        32984,
        97502,
        91842,
        98270,
        10495,
        27601,
        21878,
        52042,
        13502,
        12525,
        8362,
        62022,
        71885,
        7056,
        3456,
        52038,
        68680,
        10912,
        13623,
        34401,
        81016,
        20353,
        11051,
        85831,
        51098,
        40550,
        30063,
        32427,
        96678,
        37248,
        58086,
        82115,
        16570,
        17207,
        69042,
        22362,
        3745,
        4608,
        86973,
        46772,
        42625,
        62411,
        61236,
        70856,
        35706,
        71899,
        58307,
        17710,
        91439,
        70686,
        23205,
        77442,
        78327,
        59841,
        82713,
        98162,
        83343,
        73923,
        57014,
        68611,
        83859,
        83825,
        69965,
        40588,
        45505,
        63132,
        70736,
        29771,
        11739,
        57916,
        40353,
        47944,
        54029,
        34054,
        20411,
        39790,
        1384,
        13,
        68593,
        99392,
        17866,
        45074,
        37587,
        61499,
        70137,
        1091,
        90148,
        64479,
        99022,
        62531,
        39271,
        1198,
        56419,
        38394,
        78251,
        30306,
        947,
        71856,
        48975,
        24717,
        53968,
        73473,
        57293,
        51741,
        32755,
        21401,
        93709,
        96616,
        84672,
        51082,
        49593,
        28914,
        34470,
        10383,
        55344,
        81963,
        31400,
        67714,
        80376,
        90955,
        89738,
        35634,
        37314,
        84995,
        97377,
        69723,
        35236,
        54121,
        24642,
        8974,
        23909,
        17908,
        37958,
        14465,
        83479,
        59683,
        80968,
        59346,
        35670,
        91813,
        81626,
        64487,
        24614,
        42028,
        2543,
        19943,
        6506,
        70120,
        2901,
        24372,
        13406,
        36978,
        35284,
        16390,
        93743,
        57465,
        95304,
        1076,
        30515,
        11823,
        19751,
        1931,
        64695,
        28468,
        44816,
        55083,
        40839,
        65326,
        48680,
        60777,
        91349,
        4160,
        43287,
        10516,
        98379,
        19149,
        7346,
        34932,
        51436,
        9357,
        71198,
        61624,
        23804,
        25192,
        32779,
        50015,
        1654,
        15986,
        93675,
        32632,
        50437,
        58060,
        32397,
        96682,
        4393,
        26107,
        60403,
        96381,
        12316,
        68307,
        87295,
        27322,
        61975,
        51004,
        89319,
        40909,
        42345,
        20790,
        82466,
        95452,
        5530,
        97613,
        72035,
        68279,
        16010,
        33203,
        63076,
        83693,
        39167,
        26048,
        47242,
        6828,
        87386,
        28546,
        14802,
        30929,
        82957,
        56907,
        42535,
        1975,
        21937,
        36189,
        76638,
        15683,
        51880,
        31863,
        1171,
        5505,
        76163,
        90539,
        62295,
        90231,
        78147,
        20316,
        48680,
        11729,
        32601,
        20670,
        65526,
        11981,
        89909,
        81088,
        44358,
        99558,
        81938,
        7872,
        7835,
        46599,
        84486,
        20175,
        91925,
        70301,
        14077,
        16493,
        63943,
        30498,
        41516,
        73185,
        84496,
        99182,
        45524,
        57504,
        96101,
        25293,
        2799,
        90342,
        49515,
        46946,
        94949,
        17660,
        32860,
        5176,
        63610,
        92619,
        57345,
        73273,
        38629,
        71138,
        91363,
        64238,
        24875,
        74279,
        24462,
        71254,
        45570,
        42426,
        95998,
        61394,
        36088,
        78471,
        72683,
        21017,
        9028,
        69618,
        20320,
        58902,
        38755,
        34518,
        70990,
        48119,
        59518,
        95,
        83628,
        66317,
        49682,
        96162,
        24319,
        2454,
        81230,
        47721,
        81291,
        31299,
        42035,
        94504,
        8303,
        86284,
        70643,
        50790,
        24887,
        68691,
        89552,
        65215,
        72282,
        20203,
        80353,
        37111,
        42284,
        53714,
        84005,
        42209,
        14479,
        12617,
        68577,
        86363,
        8740,
        5738,
        17010,
        23415,
        4100,
        26487,
        14032,
        63619,
        25116,
        12944,
        4171,
        74844,
        84116,
        50935,
        86236,
        64214,
        68921,
        81786,
        91923,
        77372,
        33547,
        6434,
        48019,
        28931,
        79424,
        94090,
        9290,
        1716,
        27360,
        85951,
        64410,
        10481,
        61350,
        83745,
        7957,
        47308,
        73141,
        97450,
        54520,
        48375,
        92856,
        7642,
        80863,
        34841,
        69340,
        5329,
        96247,
        9226,
        39834,
        10216,
        28299,
        68090,
        12730,
        13268,
        95050,
        30280,
        69686,
        50507,
        24833,
        25313,
        68970,
        86099,
        32606,
        74715,
        81963,
        23449,
        73194,
        98199,
        73157,
        54420,
        97794,
        13830,
        83706,
        75572,
        46919,
        88408,
        60126,
        92085,
        87195,
        55978,
        13645,
        21865,
        23645,
        72086,
        52633,
        66152,
        44239,
        86185,
        20733,
        69980,
        78633,
        58067,
        46180,
        41308,
        72101,
        42554,
        48723,
        54047,
        83001,
        56439,
        95141,
        42396,
        79746,
        31552,
        73813,
        71517,
        28040,
        49161,
        72121,
        97594,
        33304,
        47188,
        59298,
        58655,
        52048,
        26,
        95200,
        4544,
        37288,
        78088,
        2137,
        67845,
        17706,
        39563,
        861,
        39366,
        29084,
        28158,
        41276,
        2845,
        90403,
        36171,
        72570,
        67014,
        72919,
        74799,
        74923,
        20279,
        12359,
        4947,
        60342,
        46617,
        20462,
        18142,
        34733,
        48115,
        76305,
        32750,
        30540,
        33587,
        39362,
        12047,
        74775,
        52403,
        74589,
        28500,
        96242,
        10119,
        94842,
        42559,
        63247,
        22663,
        64000,
        90387,
        92124,
        75528,
        12500,
        78019,
        84182,
        39374,
        4899,
        95787,
        75535,
        50011,
        10287,
        7330,
        43830,
        45604,
        56926,
        54595,
        15800,
        29717,
        98000,
        85562,
        78945,
        1499,
        83085,
        82863,
        50134,
        7095,
        39949,
        68732,
        5398,
        41854,
        70770,
        74045,
        19606,
        42839,
        65851,
        91458,
        28941,
        20080,
        6622,
        88295,
        95890,
        51496,
        58408,
        98677,
        78006,
        75400,
        66156,
        11808,
        29110,
        56615,
        37983,
        51685,
        19401,
        17327,
        44063,
        10820,
        62372,
        74900,
        97690,
        6464,
        71848,
        52323,
        34414,
        11152,
        52236,
        65775,
        56950,
        91472,
        17089,
        99882,
        17678,
        63036,
        73309,
        25967,
        63945,
        51816,
        85492,
        74886,
        25704,
        73554,
        80740,
        96426,
        68715,
        32276,
        31761,
        9391,
        34899,
        56370,
        42391,
        89750,
        75500,
        11744,
        14750,
        88048,
        54210,
        55515,
        47877,
        45654,
        24968,
        42040,
        45158,
        77841,
        85906,
        3173,
        39954,
        22185,
        45839,
        80770,
        57962,
        81682,
        19113,
        57733,
        5883,
        30604,
        26174,
        89832,
        48998,
        20447,
        99318,
        95485,
        11248,
        14729,
        96939,
        7149,
        31857,
        81397,
        19357,
        37708,
        1801,
        44994,
        90938,
        14586,
        39993,
        58991,
        61760,
        2982,
        43500,
        27396,
        96995,
        70518,
        27771,
        26713,
        71621,
        68586,
        98351,
        33903,
        71933,
        63312,
        81664,
        95673,
        18527,
        91105,
        91588,
        87591,
        2411,
        49363,
        76416,
        86970,
        69049,
        5700,
        33484,
        22325,
        7879,
        37227,
        26306,
        91296,
        80998,
        35558,
        6958,
        60944,
        85821,
        1093,
        8730,
        50941,
        86557,
        35562,
        86899,
        86521,
        47215,
        14142,
        2501,
        38338,
        85120,
        50663,
        30300,
        49900,
        66656,
        93021,
        13056,
        41348,
        63526,
        78264,
        69673,
        11538,
        24435,
        26067,
        65622,
        60030,
        73491,
        93385,
        2817,
        5211,
        32427,
        69392,
        39968,
        43722,
        64217,
        51564,
        97569,
        20579,
        2409,
        45454,
        89695,
        46126,
        46581,
        81951,
        39627,
        30960,
        65701,
        36160,
        8128,
        82024,
        33775,
        50748,
        3863,
        72738,
        36726,
        29568,
        19885,
        44799,
        51492,
        86106,
        17992,
        11508,
        95669,
        50097,
        68252,
        88867,
        80275,
        81989,
        89984,
        29810,
        54701,
        31505,
        75091,
        20022,
        55898,
        40945,
        79347,
        43161,
        58874,
        71072,
        17272,
        27101,
        85521,
        18164,
        76157,
        70957,
        89660,
        26518,
        18103,
        40502,
        90248,
        92424,
        68657,
        17728,
        56370,
        19026,
        86014,
        74036,
        20716,
        41615,
        8889,
        73052,
        69857,
        94299,
        15518,
        24135,
        41629,
        19074,
        95300,
        3865,
        41772,
        54270,
        53904,
        39761,
        58066,
        97729,
        83473,
        96776,
        35888,
        19918,
        24633,
        13995,
        17242,
        24216,
        3434,
        99936,
        80214,
        80865,
        34979,
        79378,
        74324,
        80264,
        30267,
        78167,
        30433,
        30267,
        90096,
        3419,
        47090,
        10418,
        90197,
        62470,
        17576,
        65841,
        79261,
        61442,
        93326,
        85141,
        49016,
        24115,
        50786,
        64415,
        62109,
        18025,
        21468,
        25331,
        29659,
        4225,
        53555,
        1968,
        35371,
        54139,
        29171,
        97304,
        87994,
        26586,
        99324,
        26813,
        8669,
        23210,
        57578,
        80880,
        64218,
        90160,
        42585,
        59972,
        32347,
        56041,
        53067,
        5483,
        79683,
        96382,
        49857,
        94399,
        41013,
        51663,
        80152,
        97317,
        74965,
        77832,
        70276,
        68844,
        84069,
        92290,
        5048,
        68243,
        14329,
        59194,
        59887,
        5560,
        32208,
        67988,
        70500,
        51854,
        96361,
        5145,
        73099,
        50778,
        67650,
        82661,
        6462,
        24885,
        38166,
        57614,
        52172,
        39919,
    ],
    37478,
    1610,
)
print(ans)
